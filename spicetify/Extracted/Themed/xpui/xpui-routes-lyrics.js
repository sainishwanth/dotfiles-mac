"use strict";(("undefined"!=typeof self?self:global).webpackChunkopen=("undefined"!=typeof self?self:global).webpackChunkopen||[]).push([[6025],{22578:(e,t,r)=>{r.d(t,{$:()=>d});var a=r(67294),i=r(64593),n=r(20657),c=r(69691),s=r(8341),l=r(89952),o=r(52883),m=r(24183);function u(e){return e.includes("Spotify")?e:`Spotify – ${e}`}const d=({children:e,usePlayingItem:t})=>{let r=u(e);(e=>{const{mainLandmarkRef:t}=(0,m.Oh)(),r=(0,o.k6)(),i=r.location?.state?.preventMoveFocus,n=(0,a.useRef)(r.length<2);n.current=r.length<2,(0,a.useEffect)((()=>{const r=t.current;!i&&!n.current&&r&&e&&(r.setAttribute("aria-label",e),r.focus())}),[e,t,i])})(e);const{isPlaying:d}=(0,c.IK)(),y=(0,s.Y)((e=>e?.item));return y&&(d||t)&&((0,l.G_)(y)?r=[y.name,y.artists.map((e=>e.name)).join(n.ag.getSeparator())].join(" • "):(0,l.iw)(y)?r=[y.name,y.show.name].join(" • "):(0,l.k6)(y)&&(r=u(n.ag.get("ad-formats.advertisement")))),a.createElement(i.q,{defaultTitle:"Spotify",defer:!1},a.createElement("title",null,r))}},70369:(e,t,r)=>{r.d(t,{$:()=>a.$});var a=r(22578)},14412:(e,t,r)=>{r.r(t),r.d(t,{default:()=>Fe});var a=r(67294),i=r(91247),n=r(46458),c=r(69518),s=r.n(c),l=r(73012),o=r(87577),m=r(49207),u=r(31595),d=r(45106),y=r(8341),g=r(55799),v=r(49104),p=r(70369),f=r(10001),b=r(88767),E=r(96511),k=r(48015);var h=r(68120);function N(e,t,r){const{startTimeMs:a,words:i}=e,n=r[t+1];return{start:a||0,end:n&&n.startTimeMs?n.startTimeMs:1/0,text:i}}function L(e){const t=function(e){return{r:e>>16&255,g:e>>8&255,b:255&e}}(e);return k.I.fromRGB(t).toCSS(k.j.RGB)}const I=(e,t,r=!1)=>{const a=["lyrics",{uri:e,image:t,vocalRemoval:r}],{data:i,isLoading:n,isError:c}=(0,b.useQuery)(a,(async()=>e&&t&&s().isTrack(e)?await async function(e,t,r){try{const n=await(0,h.S)(e,t,r);return{hasLyrics:!0,isTimeSynced:(i=n.lyrics.syncType,"LINE_SYNCED"===i||"SYLLABLE_SYNCED"===i),syncType:n.lyrics.syncType,lyrics:n.lyrics.lines.map(N),colors:(a=n.colors,{text:L(a.text),activeText:L(a.highlightText),background:L(a.background)}),provider:n.lyrics.provider,providerDisplayName:n.lyrics.providerDisplayName,providerLyricsId:n.lyrics.providerLyricsId,hasVocalRemoval:n.hasVocalRemoval??!1}}catch(e){if(e instanceof E.m&&404===e.status)return{hasLyrics:!1};throw e}var a,i}(e,t,r):{hasLyrics:!1}),{cacheTime:18e5});return{data:i??null,loading:n,error:c}};var S=r(20657),T=r(38470);const x="hW9km7ku6_iggdWDR_Lg",w="IIFWQwWvkxpl3swKeHSx",D="ihTTWcgqNLcQ_cg7Bubg",_="T67LFP0PElpfkkLuegQt",O="AEfhRyqGa3vzQrgfdwWE",B="LvLs_UgYs7ps5KdoCr0h",F="sBjjiOPNOtqSuitK1cLZ",G="fSKBdxsPEB5WUAJWTYlh",C="_T5UDP2tItG9WGdwO5Yi",A="YRcOaDMQH71HylItIhW6",Y="vUzb9hvfXJN11OcnaszM",R="Re403AJffPPuZmX7LRJj",U="EKdvOmPl7kNCDg_yuma8",V=a.memo((function({version:e}){const t=[S.ag.get("web-player.lyrics.noLyrics0"),S.ag.get("web-player.lyrics.noLyrics1"),S.ag.get("web-player.lyrics.noLyrics2"),S.ag.get("web-player.lyrics.noLyrics3")];let r;switch(e){case"ad":r=S.ag.get("web-player.lyrics.ad");break;case"error":r=S.ag.get("web-player.lyrics.error");break;case"unavailable":r=t[Math.floor(Math.random()*t.length)];break;default:(0,T.U)(e)}return a.createElement("div",{className:_},a.createElement("span",{className:U},r))}));var W=r(28760),z=r(23716),M=r(52759),P=r(24643),q=r(8271);function J(e){const{trackUri:t,format:r,provider:i,providerLyricsId:n,syncType:c,playbackId:s}=e,[l,o]=(0,a.useState)(!1),[m,u]=(0,a.useState)(0),d=(0,a.useMemo)((()=>(0,P.N)({lyrics_format:r,track_uri:t,provider:i,provider_lyrics_id:n,sync_type:c,playback_id:s})),[r,i,n,c,t,s]);(0,a.useEffect)((()=>{o(!1),u(0)}),[d]);const y=(0,q.s4)();return(0,a.useEffect)((()=>{l||m>=140&&(y.send(d),o(!0))}),[m,l,d,y]),u}var K=r(70131),j=r(32648);const H="XhqhT8BYwh_Ebk_zFHvA",Q="HiVDAl0LvHLB_YdI9xwQ",Z="gaHIufRWhoWbiT8S6zuM",$="t0iEG6xYBDhK_mFvkCp0",X="KnFq2ijXFdOtyl4Iebjv",ee="Qo3OkrSis5IWlP9Tchbr",te="I4K12o0qDoITOLr2AEs0",re="OYiGFGZJDIZ4FF4ZTDK2",ae=a.memo((function({onObserve:e,text:t,lineNumber:r,activeLineIndex:n,isTimeSynced:c,handleLyricsClick:s}){const{ref:l,inView:o}=(0,K.YD)({threshold:0,triggerOnce:!0});(0,a.useEffect)((()=>{o&&e(t)}),[o,e,t]);const m=(0,a.useRef)(),u=(0,a.useRef)(!0),d=(0,a.useContext)(j.VX);return(0,a.useEffect)((()=>{if(c&&n===r||c&&0===r&&n<0){const e=m.current?.getBoundingClientRect().top,t=d.scrollNodeRef.current?.getBoundingClientRect().height,r=t/4;if((e<r||e>t-r)&&!u.current&&n>=0)return;const a=u.current?"auto":"smooth";m.current?.scrollIntoView({behavior:a,block:"center",inline:"center"})}u.current=!1}),[n,c,r,m,d]),a.createElement("div",{dir:"auto",className:(0,i.cx)(Z,{[$]:n===r,[X]:n>r,[ee]:!c}),"data-testid":"fullscreen-lyric",ref:e=>{l(e),m.current=e||void 0},onClick:e=>s(e,r)},t)})),ie={start:0,end:1,text:""},ne=a.memo((function({trackUri:e,data:t}){const{lyrics:r=[],provider:i,providerLyricsId:n,providerDisplayName:c,syncType:s,isTimeSynced:l}=t,[o]=(0,M.z)(500,(t=>t?.item?.uri===e)),m=(0,y.Y)((e=>e?.playbackId??void 0)),u=J({trackUri:e,format:"fullscreen",provider:i,providerLyricsId:n,syncType:s,playbackId:m}),d=(0,a.useCallback)((e=>{e.length>1&&u((t=>t+e.length))}),[u]),g=(0,a.useMemo)((()=>[ie,ie,...r].map(((e,t)=>({...e,lineNumber:t})))),[r]),v=l?g.findIndex((({start:e,end:t})=>o>=e&&o<t)):-1,p=(0,z.g)(),f=(e,t)=>{if(l){e.target.scrollIntoView({behavior:"smooth",block:"center",inline:"center"}),p.seekTo(g[t].start);const r=p.getState();r&&!r.isPaused||p.resume()}};return a.createElement("div",{className:H},a.createElement("div",{className:Q},!l&&a.createElement(W.Dy,{as:"p",variant:"mesto",className:re,dir:"auto"},S.ag.get("web-player.lyrics.unsynced")),g.map((({text:e,lineNumber:t})=>a.createElement(ae,{key:t,text:e,lineNumber:t,activeLineIndex:v,isTimeSynced:l,onObserve:d,handleLyricsClick:f}))),c&&a.createElement(W.Dy,{as:"p",variant:"mesto",className:te,dir:"auto"},S.ag.get("web-player.lyrics.providedBy",c))))}));var ce=r(94184),se=r.n(ce),le=r(57518),oe=r(7762),me=r(27808),ue=r(26912),de=r(62312),ye=r(41374),ge=r(32626),ve=r(30005),pe=r(36652),fe=r(21691),be=r(66587);const Ee="qnJd7AVNVGM33NxaibzG",ke="tPJJwfJAQV0WDsE9Kfmd",he=[{volume:be.B.SING_ALONG_OFF,icon:a.createElement(le.D,{iconSize:16}),get label(){return S.ag.get("singalong.off")}},{volume:be.B.HIGH,icon:a.createElement(oe.d,{iconSize:16}),get label(){return S.ag.get("singalong.more-vocal")}},{volume:be.B.LOW,icon:a.createElement(me.J,{iconSize:16}),get label(){return S.ag.get("singalong.less-vocal")}}],Ne=a.memo((function({currentTrackUri:e}){const{isSupported:t,volume:r,setVocalVolume:i}=(e=>{const t=(0,g.$)(),[r,i]=(0,a.useState)(be.B.SING_ALONG_OFF),{isSupported:n}=t.getCapabilities();return(0,a.useEffect)((()=>{t.setStatus(be.q.DISABLED).then((()=>{i(be.B.SING_ALONG_OFF)}))}),[e,t]),(0,a.useEffect)((()=>()=>{t.setStatus(be.q.DISABLED)}),[t]),{isSupported:n,volume:r,setVocalVolume:(0,a.useCallback)((async e=>{e===be.B.SING_ALONG_OFF?await t.setStatus(be.q.DISABLED):await t.setStatus(be.q.ENABLED),await t.setVocalVolume(e),i(e)}),[t])}})(e),n=(0,a.useCallback)((e=>{t&&i(e.volume)}),[t,i]);if(!t)return null;const c=he.find((e=>e.volume===r)),s=c?.volume===be.B.SING_ALONG_OFF;return a.createElement(ge.yj,{menu:a.createElement(ve.v,null,a.createElement(pe.F,null,S.ag.get("singalong.title")),he.map((e=>a.createElement(fe.s,{role:"menuitemradio","aria-checked":r===e.volume,"aria-label":e.label,key:e.volume,onClick:()=>n(e),icon:e.icon,iconPosition:"leading"},e.label))))},((e,t,r)=>a.createElement("button",{onClick:t,ref:r,type:"button",className:se()(Ee,{[ke]:s})},s?a.createElement(a.Fragment,null,a.createElement(ue.r,{iconSize:16}),a.createElement(W.Dy,{variant:"mesto"},S.ag.get("singalong.button"))):a.createElement(a.Fragment,null,c.icon,a.createElement(W.Dy,{variant:"mesto"},c.label)),e?a.createElement(de.U,{iconSize:16}):a.createElement(ye.i,{iconSize:16}))))})),Le={start:0,end:1,text:""},Ie={"--line-count":3},Se=a.memo((function({trackUri:e,data:t}){const{lyrics:r=[],provider:i,providerLyricsId:n,providerDisplayName:c,syncType:s}=t,[l]=(0,M.z)(500,(t=>t?.item?.uri===e)),o=(0,y.Y)((e=>e?.playbackId??void 0)),m=J({trackUri:e,format:"card",provider:i,providerLyricsId:n,syncType:s,playbackId:o}),u=(0,a.useMemo)((()=>[Le,Le,...r].map(((e,t)=>({...e,lineNumber:t})))),[r]),d=u.findIndex((({start:e,end:t})=>l>=e&&l<t)),g=(0,a.useMemo)((()=>{const e=Math.max(d-1,0);return u.slice(e,e+3+2)}),[d,u]);return(0,a.useEffect)((()=>{m((e=>u.reduce(((e,{text:t,lineNumber:r})=>{const a=t.length>1?t.length:0;return e+=d===r?a:0}),e)))}),[u,d,m]),a.createElement("div",{className:F,style:Ie},a.createElement("div",{className:Y},g.map((({text:e,lineNumber:t},r)=>{const i={"--animation-index":r};return a.createElement("p",{className:R,style:i,key:t,dir:"auto"},e)}))),c&&a.createElement(W.Dy,{as:"p",variant:"mesto",className:C,dir:"auto"},S.ag.get("web-player.lyrics.providedBy",c)))})),Te=a.memo((function({onObserve:e,text:t}){const{ref:r,inView:i}=(0,K.YD)({threshold:0});return(0,a.useEffect)((()=>{i&&e(t)}),[i,e,t]),a.createElement("p",{className:R,ref:r,dir:"auto","data-testid":"unsynced-lyric"},t)})),xe=a.memo((function({trackUri:e,data:t}){const{lyrics:r=[],provider:i,providerLyricsId:n,providerDisplayName:c,syncType:s}=t,o=(0,y.Y)((e=>e?.playbackId??void 0)),m=J({trackUri:e,format:"fullscreen",provider:i,providerLyricsId:n,syncType:s,playbackId:o}),u=(0,a.useCallback)((e=>{e.length>1&&m((t=>t+e.length))}),[m]);return a.createElement("div",{className:O},a.createElement(W.Dy,{as:"p",variant:"ballad",className:B,paddingBottom:l.mGT},S.ag.get("web-player.lyrics.unsynced")),a.createElement("div",null,r.map((({text:t},r)=>a.createElement(Te,{key:e+r,onObserve:u,text:t})))),c&&a.createElement(W.Dy,{as:"p",variant:"mesto",className:C,dir:"auto"},S.ag.get("web-player.lyrics.providedBy",c)))})),we=a.createElement("div",{className:D},a.createElement(f.H,null)),De=a.createElement(V,{version:"error"}),_e=a.createElement(V,{version:"ad"}),Oe=a.createElement(V,{version:"unavailable"}),Be={active:l.ixZ,inactive:l.Snx,background:l.tGJ,messaging:l.ixZ},Fe=()=>{const e=(0,g.$)(),{isSupported:t}=e.getCapabilities(),r=(0,o.W6)(m.cp),c=(0,o.W6)(m.bD),l=r&&t,f=(0,d.O)(),b=(0,y.Y)((e=>e?.item),((e,t)=>e?.uri===t?.uri)),E=b?.uri||"",k=(0,v.o)(b?.images||void 0,{desiredLabel:"large",desiredSize:600}),{data:h,loading:N,error:L}=I(E,k||b?.images?.[0].url||"",l);let S=Be;h?.hasLyrics&&(S={active:h.colors.activeText,inactive:h.colors.text,background:h.colors.background,messaging:h.colors.text}),(0,u.Y)(S.background,Be.background);const T=(0,y.Y)((e=>e?.nextItems?.[0]),((e,t)=>e?.uri===t?.uri));I(T?.uri||"",T?.images?.[0]?.url||"",l);let D=we,_=!1;if(E)if(s().isAd(E))D=_e;else if(L)D=De;else if(N)D=we;else if(h)if(h.hasLyrics){const e=f.activeDevice?.isLocal??!1;_=l&&h.hasVocalRemoval&&e,D=c?a.createElement(ne,{trackUri:E,data:h,key:E}):h.isTimeSynced?a.createElement(Se,{trackUri:E,data:h}):a.createElement(xe,{trackUri:E,data:h})}else D=Oe;const O=(0,n.v9)((e=>e.ads.leaderboard.isEnabled)),B={"--lyrics-color-active":S.active,"--lyrics-color-inactive":S.inactive,"--lyrics-color-background":S.background,"--lyrics-color-messaging":S.messaging};return a.createElement(a.Fragment,null,a.createElement(p.$,{usePlayingItem:!0},"Spotify"),a.createElement("div",{className:(0,i.cx)(x,{[w]:O}),style:B},a.createElement("div",{className:G}),D,_?a.createElement("div",{className:A},a.createElement(Ne,{currentTrackUri:E})):null))}}}]);
//# sourceMappingURL=xpui-routes-lyrics.js.map